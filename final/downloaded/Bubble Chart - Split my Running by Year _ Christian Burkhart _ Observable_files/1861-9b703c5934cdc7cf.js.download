"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1861],{61870:function(e,t,n){n.d(t,{CU:function(){return c},Kj:function(){return f},au:function(){return d},dY:function(){return y},gg:function(){return b},iQ:function(){return a},kO:function(){return h},qc:function(){return g},r2:function(){return p},rw:function(){return m}});var s=n(41799),i=n(602),o=n(27193),l=n(3142),u=n(52054);const a=()=>({isPublishing:!0});function r(e,t){e({type:"showErrorToast",message:t,key:"publish"}),e({type:"publishFailed"})}const c=async(e,t,n)=>{let{notebook:s}=e,{unlisted:u,customSlug:a,customThumbnail:c,live:d}=t;if(s.isPublishing)return;const{id:h,slug:p,thumbnail:b}=s,g=(0,o.Ui)("model"in s?s.model:"title"in s?s:null);if(void 0!==a&&p!==a){n({type:"showProcessingToast",key:"publish",message:"Setting slug for ".concat(g,"\u2026")});try{await(0,i.Fv)("/document/".concat(h,"/slug"),{slug:a||null})}catch(f){return void(f.errors&&f.errors.length>0&&"SLUG_INVALID"===(null===f||void 0===f?void 0:f.errors[0].code)?r(n,"Setting notebook URL failed: URL invalid."):r(n,"Oops, setting notebook URL failed. Try again?"))}}let m=b;if(void 0!==c&&(c||b!==s.defaultThumbnail)&&c!==b){n({type:"showProcessingToast",key:"publish",message:"Setting thumbnail for ".concat(g,"\u2026")});try{m=await(0,i.Fv)("/document/".concat(h,"/thumbnail"),{thumbnail:c||null})||s.defaultThumbnail}catch(v){return void r(n,"Oops, setting notebook thumbnail failed. Try again?")}}const y={version:s.saveVersion,title:g,unlisted:u,live:d};try{n({type:"showProcessingToast",key:"publish",message:d?"Making ".concat(g," public\u2026"):"Publishing ".concat(g,"\u2026")});const{slug:e,update_time:t,access_level:o}=await(0,i.Fv)("/document/".concat(h,"/publish"),y);n({type:"showSuccessToast",message:d?"".concat(g," made public"):u?(0,l.cg)(s)?"Republished '".concat(g,"' (unlisted)"):"Published '".concat(g,"' (unlisted)"):(0,l.s9)(s)?"Republished '".concat(g,"'"):"Published '".concat(g,"'"),key:"publish"}),n({type:"publishSucceeded",publishVersion:s.saveVersion,updateTime:t,publishLevel:o,slug:e,thumbnail:m}),n({type:"updatedNotebook"})}catch(k){r(n,u?"Oops, unlisted publishing failed. Try again?":"Oops, publishing failed. Try again?")}},d=(e,t)=>{let{publishVersion:n,updateTime:i,slug:o,thumbnail:a,publishLevel:r}=t;const{publishTime:c,roles:d}=e,h=(0,l.os)(e)&&"live"===r&&"editorStates"in e?(0,u.qk)(e,!1):null,p="live"===r?d.filter((e=>"readonly"!==e)):d;return(0,s.Z)({publishLevel:r,publishVersion:n,publishTime:c||i,editUnpublished:!1,thumbnail:a,slug:o,isPublishing:!1,roles:p},h)},h=async(e,t,n)=>{let{notebook:s}=e,{unlisted:l}=t;if(s.isPublishing)return;const u=(0,o.Ui)("model"in s?s.model:"title"in s?s:null),a={version:s.saveVersion,live:!0,unlisted:l};try{let e=s.publishLevel;e!==(l?"live_unlisted":"live")&&(n({type:"showProcessingToast",key:"publish",message:"Making ".concat(u," public").concat(l?" (unlisted)":"","\u2026")}),({access_level:e}=await(0,i.Fv)("/document/".concat(s.id,"/publish"),a)),n({type:"showSuccessToast",message:"".concat(u," made public").concat(l?" (unlisted)":""),key:"publish"})),n({type:"publishLiveSucceeded",publishLevel:e}),n({type:"updatedNotebook"})}catch(c){r(n,"Oops, making public failed. Try again?")}},p=(e,t)=>{let{publishLevel:n}=t;const{roles:i}=e,o=(0,l.os)(e)&&"live"===n&&"editorStates"in e?(0,u.qk)(e,!1):null,a="live"===n?i.filter((e=>"readonly"!==e)):i;return(0,s.Z)({publishLevel:n,editUnpublished:!1,isPublishing:!1,roles:a},o)},b=()=>({isPublishing:!1}),g=()=>({isUnpublishing:!0}),m=async(e,t,n)=>{let{notebook:s}=e;if(s.isUnpublishing)return;const l=(0,o.Ui)("model"in s?s.model:"title"in s?s:null),u="live"===s.publishLevel||"live_unlisted"===s.publishLevel;try{n({type:"showProcessingToast",key:"unpublish",message:u?"Removing public access to ".concat(l,"\u2026"):"Unpublishing ".concat(l,"\u2026")});const e=await(0,i.Fv)("/document/".concat(s.id,"/unpublish"),void 0);n({type:"showSuccessToast",message:u?"Removed public access to ".concat(l):"Unpublished '".concat(l,"'"),key:"unpublish"}),n({type:"unpublishSucceeded",slug:e.slug||null})}catch(a){n({type:"showErrorToast",message:u?"Oops, removing public access failed. Try again?":"Oops, unpublishing failed. Try again?",key:"unpublish"}),n({type:"unpublishFailed"})}},y=(e,t)=>{let{slug:n}=t;return{publishLevel:"private",publishVersion:null,publishTime:null,editUnpublished:!1,slug:n,isUnpublishing:!1}},f=()=>({isUnpublishing:!1})},6826:function(e,t,n){n.d(t,{B:function(){return o},b:function(){return l}});var s=n(602),i=n(19671);const o=async(e,t,n)=>{let{notebook:o,currentUser:l}=e;const{currentMembers:u,newMembers:a,newRoles:r,message:c}=t,{id:d}=o,h=a.filter((e=>!u.some((t=>t.id===e.id&&t.role===e.role))&&"member"===e.status)),p=u.filter((e=>!a.some((t=>t.id===e.id))&&"member"===e.status)),b=a.filter((e=>!u.some((t=>t.id===e.id&&t.role===e.role))&&"invited"===e.status)).map((e=>({email:e.login,role:e.role}))),g=u.filter((e=>!a.some((t=>t.id===e.id))&&"invited"===e.status)).map((e=>({email:e.login}))),m=a.some((e=>"team"===e.type))?"team":a.length>1?"shared":"private";await(0,s.Fv)("/document/".concat(d,"/roles"),{roles:h.map((e=>{let{id:t,role:n}=e;return{user_id:t,role:n}})).concat(p.map((e=>{let{id:t}=e;return{user_id:t,role:null}}))),invitations:b.map((e=>({email:e.email,role:e.role}))).concat(g.map((e=>({email:e.email,role:null})))),message:c});for(const{id:s,role:y,type:f}of h)(0,i.MR)((0,i.ym)({type:"notebook:manage:changeRole",notebook:o,currentUser:l,data:{prevRole:(h.find((e=>e.id===s))||{}).role||null,newRole:y,userId:s,userType:f},eventVersion:4})),ga("send","event","Notebook","Change role");for(const{id:s,type:y}of p)(0,i.MR)((0,i.ym)({type:"notebook:manage:changeRole",notebook:o,currentUser:l,data:{prevRole:(p.find((e=>e.id===s))||{}).role||null,newRole:null,userId:s,userType:y},eventVersion:4})),ga("send","event","Notebook","Change role");n({type:"shareSucceeded",newSharing:m,newRoles:r}),n({type:"updatedNotebook"})},l=(e,t)=>{let{newSharing:n,newRoles:s}=t;if(0!==s.length)return{sharing:n,roles:s};location.replace("/")}},41894:function(e,t,n){n.d(t,{g:function(){return o},m:function(){return i}});var s=n(602);const i=async(e,t,n)=>{let i,{slug:o}=t;const{notebook:{id:l}}=e;try{i=await(0,s.Fv)("/document/".concat(l,"/slug"),{slug:o})}catch(u){return void(u.errors&&u.errors.length>0&&"SLUG_INVALID"===u.errors[0].code?n({type:"showErrorToast",message:"Setting notebook URL failed: URL invalid.",key:"setSlug"}):n({type:"showErrorToast",message:"Oops, setting notebook URL failed. Try again?",key:"setSlug"}))}n({type:"setSlugSucceeded",slug:i.slug}),n({type:"updatedNotebook"})},o=(e,t)=>{let{slug:n}=t;return{slug:n}}},16504:function(e,t,n){n.d(t,{QJ:function(){return r},fv:function(){return u},pT:function(){return a},zu:function(){return c}});var s=n(85893),i=n(39736),o=n(602),l=n(36448);const u=async(e,t,n)=>{let{notebook:{id:l}}=e,{trashed:u,relocate:a=!0}=t;const r={trashed:u};try{await(0,o.Fv)("/document/".concat(l,"/trash"),r),n({type:"trashSucceeded",trashed:u,relocate:a}),a||(n({type:"showSuccessToast",message:u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[i.MI,"Moved to trash"]}),(0,s.jsx)("button",{onClick:()=>{n({type:"trashRequested",trashed:!1,relocate:a})},className:"pa0 fw6 no-underline gray hover-dark-gray bg-transparent bn pointer",children:"Undo"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[i.MI,"Moved out of trash"]}),(0,s.jsx)("button",{onClick:()=>{n({type:"trashRequested",trashed:!0,relocate:a})},className:"pa0 fw6 no-underline gray hover-dark-gray bg-transparent bn pointer",children:"Undo"})]}),key:"trash"}),n({type:"updatedNotebook"}))}catch(c){n({type:"trashFailed"}),n({type:"showErrorToast",message:u?"Oops, trashing failed. Try again?":"Oops, moving out of trash failed. Try again?",key:"trash"})}},a=()=>({isUpdatingTrash:!0}),r=(e,t)=>{let{owner:n}=e,{trashed:s,relocate:i}=t;if(!s||!i)return{trashed:s,isUpdatingTrash:!1};location.replace((0,l.GN)(n))},c=()=>({isUpdatingTrash:!1})},4387:function(e,t,n){n.d(t,{$:function(){return o},W:function(){return l}});var s=n(602),i=n(27193);const o=async(e,t,n)=>{let{notebook:o}=e,{customThumbnail:l}=t;const{id:u,thumbnail:a}=o,r=(0,i.Ui)("model"in o?o.model:"title"in o?o:null);if((l||a!==o.defaultThumbnail)&&l!==a){n({type:"showProcessingToast",key:"thumbnail",message:"Setting thumbnail for ".concat(r,"\u2026")});try{const e=await(0,s.Fv)("/document/".concat(u,"/thumbnail"),{thumbnail:l||null});n({type:"showSuccessToast",key:"thumbnail",message:"Updated thumbnail"}),n({type:"setNotebookThumbnailSucceeded",customThumbnail:e}),n({type:"updatedNotebook"})}catch(c){return void n({type:"showErrorToast",message:"Oops, setting notebook thumbnail failed. Try again?",key:"thumbnail"})}}},l=(e,t)=>{let{defaultThumbnail:n}=e,{customThumbnail:s}=t;return{customThumbnail:s,thumbnail:s||n}}},810:function(e,t,n){n.d(t,{l:function(){return p}});var s=n(24205),i=n(21312),o=n(67220),l=n(61870),u=n(6826),a=n(41894),r=n(59533),c=n(16504),d=n(30169),h=n(4387);const p={collections:i.N5,descriptionUpdate:o.y,publishLiveRequested:l.kO,publishRequested:l.CU,publishSucceeded:s.dE,publishLiveSucceeded:s.dE,showModal:d.k,setNotebookThumbnail:h.$,setSlug:a.m,setSlugSucceeded:s.pf,share:u.B,transfer:r.r,trashRequested:c.fv,trashSucceeded:s.d$,unpublishRequested:l.rw,unpublishSucceeded:s.CL}},54937:function(e,t,n){n.d(t,{x:function(){return c}});var s=n(17152),i=n(61870),o=n(6826),l=n(41894),u=n(59533),a=n(16504),r=n(4387);const c={forkFailed:s.L3,forkPending:s.cL,publishRequested:i.iQ,publishSucceeded:i.au,publishFailed:i.gg,publishLiveSucceeded:i.r2,setNotebookThumbnailSucceeded:r.W,setSlugSucceeded:l.g,shareSucceeded:o.b,trashFailed:a.zu,trashRequested:a.pT,transferSucceeded:u.I,trashSucceeded:a.QJ,unpublishRequested:i.qc,unpublishSucceeded:i.dY,unpublishFailed:i.Kj}}}]);